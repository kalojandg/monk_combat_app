<!DOCTYPE html>
<html lang="bg">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monk Sheet Lite ‚Äî v3</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="theme-color" content="#0b0c12" />
  <style>
    :root {
      --bg: #0b0c12;
      --panel: #0f111a;
      --panel2: #0b0e15;
      --muted: #9aa3b2;
      --text: #e6e6ef;
      --border: #262b3a;
      --pill: #0c0e16;
      /* –ø–æ-–±–ª–µ–¥–æ –∑–∞ spans */
      --pill2: #14182a;
      /* –ø–æ-–ø–ª—ä—Ç–Ω–æ –∑–∞ inputs/–±—É—Ç–æ–Ω–∏—Ç–µ */
      --accent: #3a7afe;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, Segoe UI, Roboto, Arial
    }

    a {
      color: var(--accent);
      text-decoration: none
    }

    .wrap {
      max-width: 1120px;
      margin: 0 auto;
      padding: 16px
    }

    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px
    }

    .title {
      font-weight: 700;
      font-size: 18px
    }

    .status-emoji {
      font-size: 20px;
      margin-left: auto
    }

    /* tabs */
    .tabs {
      display: flex;
      gap: 6px;
      margin: 8px 0 12px 0
    }

    .tab-btn {
      padding: 8px 12px;
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 10px;
      color: var(--text);
      cursor: pointer
    }

    .tab-btn.active {
      background: var(--pill2)
    }

    .tab {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      padding: 14px
    }

    .hidden {
      display: none !important
    }

    /* layout blocks */
    .row-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 12px;
      margin-bottom: 12px
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .field label {
      font-size: 12px;
      color: var(--muted)
    }

    /* inputs vs spans */
    input[type=number],
    input[type=text] {
      background: #151a2c;
      /* –º–∞–ª–∫–æ –ø–æ-–ø–ª—ä—Ç–Ω–æ –æ—Ç span */
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
    }

    .value-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 56px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #1e2230;
      /* –º–∞–ª–∫–æ –ø–æ-–Ω–µ–∂–Ω–∞ —Ä–∞–º–∫–∞ */
      background: var(--pill);
      /* –ø–æ-–±–ª–µ–¥–æ –æ—Ç input */
      font-weight: 700;
      color: #d9def2;
    }

    /* abilities */
    .abilities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px
    }

    .abil {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--panel2);
      padding: 10px
    }

    .abil .top {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px
    }

    .abil .spacer {
      flex: 1 1 auto
    }

    .abil .bottom {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .abil .save,
    .abil .mod {
      min-width: 54px;
      text-align: center
    }

    .small-note {
      font-size: 12px;
      color: var(--muted)
    }

    .section-title {
      font-weight: 700;
      margin: 2px 0 6px 2px;
      color: #cfd7ff
    }

    /* skills table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px
    }

    th,
    td {
      border-bottom: 1px solid var(--border);
      padding: 8px
    }

    th {
      color: #cfd7ff;
      text-align: left
    }

    td.right {
      text-align: right
    }

    /* COMBAT: –ø–æ-—à–∏—Ä–æ–∫–æ, –ø–æ–¥—Ä–∞–≤–Ω–µ–Ω–æ, –ø–æ-—Å–ø–æ–∫–æ–π–Ω–∏ –±—É—Ç–æ–Ω–∏ */
    .pillbar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 14px;
      margin-bottom: 14px;
    }

    .pill {
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #101527;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      font-weight: 700
    }

    .pill .big {
      font-size: 20px
    }

    /* –ø–æ–¥—Ä–∞–≤–Ω—è–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ç–µ –≤ –º—Ä–µ–∂–∞ –≤–º–µ—Å—Ç–æ ‚Äû—Å–∫–∞—á–∞–Ω–µ‚Äú */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    /* label + –≤—ä—Ç—Ä–µ—à–Ω–∏—è input –¥–∞ —Å–µ –¥—ä—Ä–∂–∞—Ç –∫–∞—Ç–æ –µ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç */
    .controls label {
      display: inline-flex;
      /* << –∫–ª—é—á—ä—Ç */
      align-items: center;
      gap: 10px;
      margin: 0;
    }

    /* –µ–¥–Ω–∞–∫–≤–∞ –≤–∏—Å–æ—á–∏–Ω–∞ –∑–∞ –ø–æ–ª–µ –∏ –±—É—Ç–æ–Ω–∏, –∑–∞ –¥–∞ —Å–∞ –Ω–∞ —Ä–∞–≤–Ω–∏ –Ω–∞—á–∞–ª–∞ */
    .controls input.small {
      height: 40px;
      padding: 0 10px;
    }

    .controls>button {
      height: 40px;
      padding: 0 18px;
      /* —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–µ–Ω –ø–∞–¥–∏–Ω–≥, –±–µ–∑ –¥–∞ –ø—Ä–æ–º–µ–Ω—è –≤–∏—Å–æ—á–∏–Ω–∞—Ç–∞ */
      align-self: center;
      /* safety, –∞–∫–æ –Ω—è–∫—ä–¥–µ —Å–µ ‚Äû–≤–¥–∏–≥–Ω–µ‚Äú –≤–∏—Å–æ—á–∏–Ω–∞ */
    }

    /* –Ω–µ –ø–æ–∑–≤–æ–ª—è–≤–∞–π –Ω–∞ –¥–µ—Ü–∞—Ç–∞ –¥–∞ —Å–µ —Ä–∞–∑—Ç—è–≥–∞—Ç –ø–æ —à–∏—Ä–∏–Ω–∞ */
    .controls>* {
      flex: 0 0 auto;
    }

    .top-right-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 0.5rem;
    }

    /* –º–∞–ª–∫–æ—Ç–æ –∏–Ω–ø—É—Ç—á–µ (HP Œî / Ki Œî) –¥–∞ –µ —Å—Ç–µ–≥–Ω–∞—Ç–æ */
    input.small {
      width: 90px;
    }

    /* –¥–∞ –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç –∫–æ–ª–æ–Ω–∏ */

    button {
      background: #1a223a;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 10px;
      cursor: pointer;
    }

    button.primary {
      background: #22315b
    }

    button.danger {
      background: #4a2730
    }

    button.success {
      background: #224a34
    }

    button:hover {
      filter: brightness(1.08)
    }

    input.small {
      width: 100%
    }

    .dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 6px;
      background: #666;
      vertical-align: middle;
      opacity: .7
    }

    .dot.ok {
      background: #2ecc71;
      opacity: 1
    }

    /* –¥–∞ –ø–∞—Å–≤–∞ –ø–æ –∫–æ–ª–æ–Ω–∞—Ç–∞ */
    .mt8 {
      margin-top: 8px
    }

    .ds-wrap { margin-top: 10px; }
.ds-row{ display:flex; align-items:center; gap:.6rem; margin:.25rem 0; }
.ds-label{ opacity:.8; min-width:70px; }

.ds-dot{
  width:18px; height:18px; border-radius:50%;
  display:inline-block; border:2px solid rgba(255,255,255,.2);
  background:transparent; box-shadow: inset 0 0 0 2px rgba(0,0,0,.2);
  transition: transform .12s ease, background .12s ease, border-color .12s ease;
}
.ds-dot.active{ background:#1f6f3e; border-color:#2ab773; }           /* success active */
.ds-dot.fail{ border-color:rgba(255,0,0,.35); }
.ds-dot.fail.active{ background:#6b1f27; border-color:#ff5b73; }      /* fail 1 */
.ds-dot.fail.lvl2{ background:#8d1f29; }                              /* fail 2 ‚Äì –ø–æ-—á–µ—Ä–≤–µ–Ω–æ */
.ds-dot.fail.lvl3{ background:#b71c1c; box-shadow:0 0 8px rgba(255,0,0,.35); } /* fail 3 */

.you-died{
  position:fixed; inset:0; background:rgba(0,0,0,.7);
  display:flex; align-items:center; justify-content:center;
  z-index:9999;
}
.you-died.hidden{ display:none; }
.you-died-card{
  background:rgba(10,10,14,.9); border:1px solid rgba(255,255,255,.1);
  padding:1.25rem 1.5rem; border-radius:.75rem; text-align:center; min-width:280px;
}
.you-died-title{
  font-size:2rem; letter-spacing:.2rem; color:#ff5252; margin-bottom:.75rem;
  text-shadow:0 0 12px rgba(255,80,80,.4);
  animation: flicker 1.6s ease-in-out infinite;
}
@keyframes flicker{
  0%,19%,21%,23%,25%,54%,56%,100%{ opacity:1 }
  20%,24%,55%{ opacity:.4 }
}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="title">Monk Sheet Lite ‚Äî v3</div>
      <div class="spacer"></div>
      <div id="lifeStatus" class="status-emoji">üôÇ</div>
      <div class="controls mt8">
        <button id="btnShortRest">Short rest</button>
        <button id="btnLongRest" class="primary">Long rest</button>
        <button id="btnExport">Export</button>
        <label class="tab-btn" for="importFile" style="cursor:pointer">Import</label>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
        <button id="btnReset" class="danger">Reset</button>
        <button id="btnCloudLink" class="pill">Cloud</button>
        <button id="btnCloudPull" class="pill ghost">Pull</button>
        <span id="cloudDot" class="dot" title="Not linked"></span>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="combat">Combat</button>
      <button class="tab-btn" data-tab="stats">Stats</button>
      <button id="btnInstall" class="tab-btn hidden" title="Install PWA">Install</button>
    </div>

    <!-- Combat tab -->
    <div id="tab-combat" class="tab">
      <div class="pillbar">
        <div class="pill">HP&nbsp;<span class="big" id="hpCurrentSpan">10</span>/<span class="big"
            id="hpMaxSpan">10</span></div>
        <div class="pill">Ki&nbsp;<span class="big" id="kiCurrentSpan">1</span>/<span class="big"
            id="kiMaxSpan2">1</span></div>
        <div class="pill">AC&nbsp;<span class="big" id="acSpan">10</span></div>
        <div class="pill">Prof&nbsp;<span class="big" id="profSpan">+2</span></div>
      </div>

      <div class="controls">
        <label>HP Œî <input id="hpDelta" type="number" class="small"></label>
        <button id="btnDamage" class="danger">Take damage</button>
        <button id="btnHeal" class="success">Heal</button>
        <button id="btnHitAtZero">Hit at 0 ‚áí DS fail</button>
        <button id="btnHealFromZero" class="success">Heal from 0</button>
      </div>

      <div class="controls mt8">
        <label>Ki Œî <input id="kiDelta" type="number" class="small"></label>
        <button id="btnSpendKi">Spend Ki</button>
        <button id="btnGainKi" class="success">Gain Ki</button>
      </div>

      <div class="controls mt8">
        <button id="btnDsPlus">Death Save +</button>
        <button id="btnDsMinus" class="danger">Death Save ‚Äì</button>
        <button id="btnCrit" class="success">Crit Success</button>
        <button id="btnCritFail" class="danger">Crit Fail (+2)</button>
        <button id="btnStabilize">Stabilize</button>
      </div>
    </div>

    <div id="deathSavesUI" class="ds-wrap">
      <div class="ds-row">
        <span class="ds-label">Success</span>
        <span class="ds-dot" id="dsS1"></span>
        <span class="ds-dot" id="dsS2"></span>
        <span class="ds-dot" id="dsS3"></span>
      </div>
      <div class="ds-row">
        <span class="ds-label">Fail</span>
        <span class="ds-dot fail" id="dsF1"></span>
        <span class="ds-dot fail" id="dsF2"></span>
        <span class="ds-dot fail" id="dsF3"></span>
      </div>
    </div>
    
    <!-- –û–≤–µ—Ä–ª–µ–π –ø—Ä–∏ —Å–º—ä—Ä—Ç -->
    <div id="youDiedOverlay" class="you-died hidden">
      <div class="you-died-card">
        <div class="you-died-title">YOU DIED</div>
        <button id="btnResurrect" class="btn success">Resurrect (1 HP)</button>
      </div>
    </div>

    <!-- Stats tab -->
    <div id="tab-stats" class="tab hidden">
      <div class="section-title">Basics</div>
      <div class="row-grid">
        <div class="field"><label>–ò–º–µ</label><input id="charName" type="text" placeholder="–ü–∏–π—Å –û—à–∏—Ç"></div>
      </div>

      <!-- Row 1 -->
      <div class="row-grid">
        <div class="field"><label>XP</label><input id="xpInput" type="number" step="1"></div>
        <div class="field"><label>Level</label><span class="value-pill" id="levelSpan">1</span></div>
        <div class="field"><label>Proficiency</label><span class="value-pill" id="profSpan2">+2</span></div>
        <div class="field"><label>Martial Arts Die</label><span class="value-pill" id="maDieSpan">d4</span></div>
      </div>

      <!-- Row 2 -->
      <div class="row-grid">
        <div class="field"><label>Max HP</label><span class="value-pill" id="maxHpSpan">10</span></div>
        <div class="field"><label>Homebrew HP</label><input type="number" id="homebrewHp" value="0"></div>
        <div class="field"><label>Max Hit Dice</label><span class="value-pill" id="hdMaxSpan">1</span></div>
        <div class="field"><label>Available Hit Dice</label><span class="value-pill" id="hdAvailSpan">1</span></div>
      </div>

      <!-- Row 3 -->
      <div class="row-grid">
        <div class="field"><label>Max Ki</label><span class="value-pill" id="kiMaxSpan">1</span></div>
        <div class="field"><label>AC (Unarmored)</label><span class="value-pill" id="acSpan2">10</span></div>
        <div class="field"><label>Magic Item Bonus (AC)</label><input id="acMagicInput" type="number" step="1"></div>
      </div>

      <!-- Row 4 -->
      <div class="row-grid">
        <div class="field"><label>Unarmored Movement (+ft)</label><span class="value-pill" id="umBonusSpan">0</span>
        </div>
        <div class="field"><label>Passive Perception</label><span class="value-pill" id="passPercSpan">10</span></div>
        <div class="field"><label>Passive Investigation</label><span class="value-pill" id="passInvSpan">10</span></div>
        <div class="field"><label>Passive Insight</label><span class="value-pill" id="passInsSpan">10</span></div>
      </div>

      <!-- All saves bonus -->
      <div class="row-grid">
        <div class="field" style="max-width:240px"><label>All Saves Bonus</label><input id="saveAllBonusInput"
            type="number" step="1" value="0"></div>
      </div>

      <!-- Abilities -->
      <div class="section-title">Abilities & Saves</div>
      <div class="abilities-grid">
        <!-- STR -->
        <div class="abil">
          <div class="top"><strong>STR</strong><span class="spacer"></span><label class="small-note"><input
                type="checkbox" id="saveStrProf"> Prof</label></div>
          <div class="bottom">
            <input id="strInput" type="number" step="1" class="small">
            <span class="value-pill mod" id="strModSpan">+0</span>
            <span class="value-pill save" id="saveStrTotalSpan">+0</span>
          </div>
        </div>
        <!-- DEX -->
        <div class="abil">
          <div class="top"><strong>DEX</strong><span class="spacer"></span><label class="small-note"><input
                type="checkbox" id="saveDexProf"> Prof</label></div>
          <div class="bottom">
            <input id="dexInput" type="number" step="1" class="small">
            <span class="value-pill mod" id="dexModSpan">+0</span>
            <span class="value-pill save" id="saveDexTotalSpan">+0</span>
          </div>
        </div>
        <!-- CON -->
        <div class="abil">
          <div class="top"><strong>CON</strong><span class="spacer"></span><label class="small-note"><input
                type="checkbox" id="saveConProf"> Prof</label><label class="small-note" style="margin-left:10px"><input
                type="checkbox" id="toughChk"> Tough</label></div>
          <div class="bottom">
            <input id="conInput" type="number" step="1" class="small">
            <span class="value-pill mod" id="conModSpan">+0</span>
            <span class="value-pill save" id="saveConTotalSpan">+0</span>
          </div>
        </div>
        <!-- INT -->
        <div class="abil">
          <div class="top"><strong>INT</strong><span class="spacer"></span><label class="small-note"><input
                type="checkbox" id="saveIntProf"> Prof</label></div>
          <div class="bottom">
            <input id="intInput" type="number" step="1" class="small">
            <span class="value-pill mod" id="intModSpan">+0</span>
            <span class="value-pill save" id="saveIntTotalSpan">+0</span>
          </div>
        </div>
        <!-- WIS -->
        <div class="abil">
          <div class="top"><strong>WIS</strong><span class="spacer"></span><label class="small-note"><input
                type="checkbox" id="saveWisProf"> Prof</label></div>
          <div class="bottom">
            <input id="wisInput" type="number" step="1" class="small">
            <span class="value-pill mod" id="wisModSpan">+0</span>
            <span class="value-pill save" id="saveWisTotalSpan">+0</span>
          </div>
        </div>
        <!-- CHA -->
        <div class="abil">
          <div class="top"><strong>CHA</strong><span class="spacer"></span><label class="small-note"><input
                type="checkbox" id="saveChaProf"> Prof</label></div>
          <div class="bottom">
            <input id="chaInput" type="number" step="1" class="small">
            <span class="value-pill mod" id="chaModSpan">+0</span>
            <span class="value-pill save" id="saveChaTotalSpan">+0</span>
          </div>
        </div>
      </div>

      <div class="section-title">Skills</div>
      <table>
        <thead>
          <tr>
            <th>Skill</th>
            <th>Ability</th>
            <th>Prof</th>
            <th class="right">Bonus</th>
          </tr>
        </thead>
        <tbody id="skillsBody"></tbody>
      </table>

      <div class="section-title">–ë–µ–ª–µ–∂–∫–∏</div>
      <textarea id="notes" rows="4"
        style="width:100%;background:#101323;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px"></textarea>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>